# M4 固定验收集定义（灰度前冻结）

## 目标

在灰度前冻结一套可重复的 `streaming` 端到端验收集，用于判断上线 Go/No-Go。

## 数据分桶

1. 安静环境：近场拾音、低噪声。
2. 噪声环境：键盘声、风噪、空调噪声、人声背景。
3. 方言/口音：普通话 + 区域口音。
4. 快语速：语速明显高于常规会话。
5. 中英混说：术语、型号、英文缩写混入。
6. 长句连续说话：单段 > 15s，检验 `max_segment` 行为。
7. 打断场景：TTS 播放中用户插话。
8. 依赖异常：ASR/Agent/TTS 超时或不可达。

## 样本规模（首发建议）

- 每个分桶至少 20 条，总计不低于 160 条。
- 每条样本包含：
  - 输入音频（16k PCM16 mono）
  - 参考文本（ground truth）
  - 预期行为标签（是否触发打断、是否允许降级）

## 样本元数据字段

- `caseId`
- `bucket`
- `audioPath`
- `referenceText`
- `expectedFinalReason`（`endpointing|max_segment|listen_stop`）
- `allowFallback`（bool）
- `expectInterrupt`（bool）
- `notes`

## 通过阈值（首发）

1. 功能通过率 >= 98%。
2. 端到端错误率 <= 2%。
3. `ASR/Agent/TTS` stage 错误率均 <= 2%。
4. 打断成功率 >= 98%。
5. 回滚开关演练成功率 = 100%。

## 执行顺序

1. 常规功能桶（安静/噪声/快语速/中英混说）。
2. 长句与 `max_segment` 桶。
3. 打断桶。
4. 依赖异常桶（降级/回滚）。

## 产出物

1. 验收明细（每 case 通过/失败 + 失败原因）。
2. 指标汇总（`/metrics` 导出快照）。
3. 告警记录（`/alerts` 导出）。
4. Go/No-Go 决策单（见 `docs/07_M4上线GoNoGo决策单.md`）。
